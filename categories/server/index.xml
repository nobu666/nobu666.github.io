<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Server on Real Beat</title>
    <link>http://localhost:1313/categories/server.html</link>
    <description>Recent content in Server on Real Beat</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>ja</language>
    <lastBuildDate>Thu, 19 May 2011 22:32:28 +0900</lastBuildDate>
    <atom:link href="http://localhost:1313/categories/server.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>さくらのVPSでCentOSからUbuntuに鞍替えまとめ</title>
      <link>http://localhost:1313/2011/05/19/0904.html</link>
      <pubDate>Thu, 19 May 2011 22:32:28 +0900</pubDate>
      
      <guid>http://localhost:1313/2011/05/19/0904.html</guid>
      <description>&lt;p&gt;&lt;a href=&#34;http://twitter.com/maccha&#34;&gt;@maccha&lt;/a&gt;からリクエストがあったので、適当にまとめました。タイトルの通りです。&lt;/p&gt;

&lt;p&gt;&lt;h2&gt;OS再インストールの準備&lt;/h2&gt;
リモートコンソールの起動にJDK必須なので、作業するマシンにJDKが入ってなければいれとく。あとはTightVNCとか、必要ならどうぞ。あとバックアップ忘れずに。とりあえずwordpressだけ動いてる状態だったので&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ mysqldump -uroot -p wp -Q -c --opt &amp;amp;gt; dumpfile
$ tar zcvf wordpress.tar.gz /var/www/wordpress
$ tar zcvf ssh.tar.gz ~/.ssh
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;みたいな感じでバックアップ取って作業マシンにscpなりlftpなりで持ってきておく。必要なら/etc/my.cnfとか/etc/php.iniとか、ホームのドットファイル類も。&lt;/p&gt;

&lt;p&gt;&lt;h2&gt;OS再インストール&lt;/h2&gt;
VPSコントロールパネルにログインして、OS再インストール→カスタムOSインストール→ubuntu 10.04 amd64を選択→&lt;a href=&#34;http://support.sakura.ad.jp/support/vps/menu_oscustom_ubuntu.shtml&#34;&gt;カスタムOSインストールガイド ： Ubuntu 10.04&lt;/a&gt;の通り進める。10分くらいありゃ終わる。&lt;/p&gt;

&lt;p&gt;&lt;h2&gt;SSHの設定&lt;/h2&gt;
何はともあれrootのパスワードとSSHの設定をリモートコンソールからやる。scpなりで、バックアップファイルを転送しとくこと。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ sudo passwd
$ tar zxf wordpress.tar.gz
$ tar zxf ssh.tar.gz
$ chmod 700 .ssh
$ chmod 600 .ssh/*
$ sudo vi /etc/ssh/sshd_config
- Port 22
+ Port 適当なポート

- PermitRootLogin yes
+ PermitRootLogin no

- #PasswordAuthentication yes
+ PasswordAuthentication no
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ポートは変えなくてもいいけどお好みで。ポート変えたら/etc/servicesのSSHのとこを合わせて変更するのも忘れずに。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ sudo sshd -t
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;でチェックして、エラーが出なければOKなので再起動&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ sudo service ssh restart
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ここで、もう一個ターミナル開いて問題なく接続できることを必ず確認。以降は普通に端末からSSHでつないで作業&lt;/p&gt;

&lt;p&gt;&lt;h2&gt;諸々設定&lt;/h2&gt;
もうあとはお好みでどうぞなんだけど、最低やることだけ書いとく&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ sudo apt-get update
.
.
.
$ sudo apt-get upgrade
.
.
.
$ sudo ufw status
Status: inactive
$ sudo ufw default deny
Default incoming policy changed to &#39;deny&#39;
(be sure to update your rules accordingly)
$ sudo ufw allow SSHのポート番号
Rules updated
$ sudo ufw allow 80
Rules updated
$ sudo ufw enable
Command may disrupt existing ssh connections. Proceed with operation (y|n)? y
Firewall is active and enabled on system startup
$ sudo ufw status
Status: active
To                         Action      From
--                           ------      ----
SSHのポート番号   ALLOW       Anywhere
80                          ALLOW       Anywhere
$ sudo apt-get install denyhosts sysv-rc-conf build-essential zsh screen vim tmux curl wget git-core apache2 php5 libapache2-mod-php5 mysql-server php5-mysql #まぁこの辺は余計なのも入ってるのでお好きなように
$ sudo a2enmod rewrite # rewrite有効に
$ sudo vi /etc/apache2/sites-available/default #VirtualHostなりなんなり、お好きにどうぞ
$ sudo service apache2 restart
$ sudo sysv-rc-conf #自動起動したいやつを適当に選択
$ cp -a wordpress/* /var/www/wordpress #wordpressのバックアップ復元
$ mysql -uroot -p -e&amp;amp;quot;create database wp&amp;amp;quot; #とりあえずDBつくる
$ sudo cp my.cnf.backup /etc/my.cnf
$ sudo service mysql restart
$ mysql -uroot -p wp &amp;amp;lt; dumpfile #dumpファイルからデータ復元
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ここまでやればwordpressはもう普通に動いてるはず。あとはchshするなり、ドットファイル復元するなり、好きにすればいいかと。&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>