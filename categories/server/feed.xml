<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Server on Real Beat</title>
    <link>http://nobu666.com/categories/server.html</link>
    <description>Recent content in Server on Real Beat</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>ja-JP</language>
    <copyright>&amp;copy; nobu666.com</copyright>
    <lastBuildDate>Thu, 19 May 2011 22:32:28 +0900</lastBuildDate>
    <atom:link href="http://nobu666.com/categories/server/feed.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>さくらのVPSでCentOSからUbuntuに鞍替えまとめ</title>
      <link>http://nobu666.com/2011/05/19/904.html</link>
      <pubDate>Thu, 19 May 2011 22:32:28 +0900</pubDate>
      
      <guid>http://nobu666.com/2011/05/19/904.html</guid>
      <description>&lt;p&gt;&lt;a href=&#34;http://twitter.com/maccha&#34;&gt;@maccha&lt;/a&gt;からリクエストがあったので、適当にまとめました。タイトルの通りです。&lt;/p&gt;

&lt;p&gt;&lt;h2&gt;OS再インストールの準備&lt;/h2&gt;
リモートコンソールの起動にJDK必須なので、作業するマシンにJDKが入ってなければいれとく。あとはTightVNCとか、必要ならどうぞ。あとバックアップ忘れずに。とりあえずwordpressだけ動いてる状態だったので&lt;/p&gt;

&lt;p&gt;[sourcecode language=&amp;ldquo;text&amp;rdquo; padlinenumbers=&amp;ldquo;2&amp;rdquo;]
$ mysqldump -uroot -p wp -Q -c &amp;ndash;opt &amp;gt; dumpfile
$ tar zcvf wordpress.tar.gz /var/www/wordpress
$ tar zcvf ssh.tar.gz ~/.ssh&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;
みたいな感じでバックアップ取って作業マシンにscpなりlftpなりで持ってきておく。必要なら/etc/my.cnfとか/etc/php.iniとか、ホームのドットファイル類も。

&amp;lt;h2&amp;gt;OS再インストール&amp;lt;/h2&amp;gt;
VPSコントロールパネルにログインして、OS再インストール→カスタムOSインストール→ubuntu 10.04 amd64を選択→&amp;lt;a href=&amp;quot;http://support.sakura.ad.jp/support/vps/menu_oscustom_ubuntu.shtml&amp;quot;&amp;gt;カスタムOSインストールガイド ： Ubuntu 10.04&amp;lt;/a&amp;gt;の通り進める。10分くらいありゃ終わる。

&amp;lt;h2&amp;gt;SSHの設定&amp;lt;/h2&amp;gt;
何はともあれrootのパスワードとSSHの設定をリモートコンソールからやる。scpなりで、バックアップファイルを転送しとくこと。

[sourcecode language=&amp;quot;text&amp;quot; padlinenumbers=&amp;quot;2&amp;quot;]
$ sudo passwd
$ tar zxf wordpress.tar.gz
$ tar zxf ssh.tar.gz
$ chmod 700 .ssh
$ chmod 600 .ssh/*
$ sudo vi /etc/ssh/sshd_config
- Port 22
+ Port 適当なポート

- PermitRootLogin yes
+ PermitRootLogin no

- #PasswordAuthentication yes
+ PasswordAuthentication no
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ポートは変えなくてもいいけどお好みで。ポート変えたら/etc/servicesのSSHのとこを合わせて変更するのも忘れずに。&lt;/p&gt;

&lt;p&gt;[sourcecode language=&amp;ldquo;text&amp;rdquo; padlinenumbers=&amp;ldquo;2&amp;rdquo;]
$ sudo sshd -t&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;
でチェックして、エラーが出なければOKなので再起動

[sourcecode language=&amp;quot;text&amp;quot; padlinenumbers=&amp;quot;2&amp;quot;]
$ sudo service ssh restart
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ここで、もう一個ターミナル開いて問題なく接続できることを必ず確認。以降は普通に端末からSSHでつないで作業&lt;/p&gt;

&lt;p&gt;&lt;h2&gt;諸々設定&lt;/h2&gt;
もうあとはお好みでどうぞなんだけど、最低やることだけ書いとく&lt;/p&gt;

&lt;p&gt;[sourcecode language=&amp;ldquo;text&amp;rdquo; padlinenumbers=&amp;ldquo;2&amp;rdquo;]
$ sudo apt-get update
.
.
.
$ sudo apt-get upgrade
.
.
.
$ sudo ufw status
Status: inactive
$ sudo ufw default deny
Default incoming policy changed to &amp;lsquo;deny&amp;rsquo;
(be sure to update your rules accordingly)
$ sudo ufw allow SSHのポート番号
Rules updated
$ sudo ufw allow 80
Rules updated
$ sudo ufw enable
Command may disrupt existing ssh connections. Proceed with operation (y|n)? y
Firewall is active and enabled on system startup
$ sudo ufw status
Status: active
To                         Action      From&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;SSHのポート番号   ALLOW       Anywhere
80                          ALLOW       Anywhere
$ sudo apt-get install denyhosts sysv-rc-conf build-essential zsh screen vim tmux curl wget git-core apache2 php5 libapache2-mod-php5 mysql-server php5-mysql #まぁこの辺は余計なのも入ってるのでお好きなように
$ sudo a2enmod rewrite # rewrite有効に
$ sudo vi /etc/apache2/sites-available/default #VirtualHostなりなんなり、お好きにどうぞ
$ sudo service apache2 restart
$ sudo sysv-rc-conf #自動起動したいやつを適当に選択
$ cp -a wordpress/* /var/www/wordpress #wordpressのバックアップ復元
$ mysql -uroot -p -e&amp;rdquo;create database wp&amp;rdquo; #とりあえずDBつくる
$ sudo cp my.cnf.backup /etc/my.cnf
$ sudo service mysql restart
$ mysql -uroot -p wp &amp;lt; dumpfile #dumpファイルからデータ復元
```&lt;/p&gt;

&lt;p&gt;ここまでやればwordpressはもう普通に動いてるはず。あとはchshするなり、ドットファイル復元するなり、好きにすればいいかと。&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>