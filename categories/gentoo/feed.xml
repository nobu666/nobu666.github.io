<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Gentoo on Real Beat</title>
    <link>http://nobu666.com/categories/gentoo.html</link>
    <description>Recent content in Gentoo on Real Beat</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>ja-JP</language>
    <copyright>&amp;copy; nobu666.com</copyright>
    <lastBuildDate>Thu, 03 Apr 2008 18:27:59 +0900</lastBuildDate>
    <atom:link href="http://nobu666.com/categories/gentoo/feed.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>mixiとblogをそのまま同期させると、del.icio.usのdaily postがmixiでは役立たずになってウザそうだからどうにかする</title>
      <link>http://nobu666.com/2008/04/03/609.html</link>
      <pubDate>Thu, 03 Apr 2008 18:27:59 +0900</pubDate>
      
      <guid>http://nobu666.com/2008/04/03/609.html</guid>
      <description>&lt;p&gt;mixiにそのまま投稿しちゃうと、本来リンクじゃないと困るものが、ただのテキストになってしまうわけで。どっちみち携帯から見てる人には無用なエントリになっちゃうし、いっそのことmixiには投稿しないようにしようと。一番てっとり早いのはP::P::MixiDiary.pm内で、単純にif文でほげほげすることなんだけど。ちょっと気が向いたのでplugin初挑戦してみた。&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;package&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;Plagger::Plugin::Filter::StripDeliciousDailyPost;&lt;/span&gt;
&lt;span style=&#34;color: #66d9ef&#34;&gt;use&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;strict;&lt;/span&gt;
&lt;span style=&#34;color: #66d9ef&#34;&gt;use&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;base&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;qw( Plagger::Plugin )&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;;&lt;/span&gt;

&lt;span style=&#34;color: #66d9ef&#34;&gt;sub &lt;/span&gt;&lt;span style=&#34;color: #a6e22e&#34;&gt;register&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;{&lt;/span&gt;
    &lt;span style=&#34;color: #66d9ef&#34;&gt;my&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;($self,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;$context)&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;@_;&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2&#34;&gt;$context&lt;/span&gt;&lt;span style=&#34;color: #f92672&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;register_hook(&lt;/span&gt;
        &lt;span style=&#34;color: #f8f8f2&#34;&gt;$self,&lt;/span&gt;
        &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;update.entry.fixup&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;\&amp;amp;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;filter,&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2&#34;&gt;);&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2&#34;&gt;}&lt;/span&gt;

&lt;span style=&#34;color: #66d9ef&#34;&gt;sub &lt;/span&gt;&lt;span style=&#34;color: #a6e22e&#34;&gt;filter&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;{&lt;/span&gt;
    &lt;span style=&#34;color: #66d9ef&#34;&gt;my&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;($self,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;$context,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;$args)&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;@_;&lt;/span&gt;

    &lt;span style=&#34;color: #66d9ef&#34;&gt;my&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;$title&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;$args&lt;/span&gt;&lt;span style=&#34;color: #f92672&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;{entry}&lt;/span&gt;&lt;span style=&#34;color: #f92672&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;title;&lt;/span&gt;
    &lt;span style=&#34;color: #66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color: #66d9ef&#34;&gt;my&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;$entry&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;($args&lt;/span&gt;&lt;span style=&#34;color: #f92672&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;{feed}&lt;/span&gt;&lt;span style=&#34;color: #f92672&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;entries)&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;{&lt;/span&gt;
        &lt;span style=&#34;color: #66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;($entry&lt;/span&gt;&lt;span style=&#34;color: #f92672&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;title&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=~&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt; /^links for \d{4}-\d{2}-\d{2}$/i&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;{&lt;/span&gt;
            &lt;span style=&#34;color: #f8f8f2&#34;&gt;$context&lt;/span&gt;&lt;span style=&#34;color: #f92672&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;log(info&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;quot;Delete Delicious daily post entry &amp;quot;&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;.&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;$entry&lt;/span&gt;&lt;span style=&#34;color: #f92672&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;link);&lt;/span&gt;
            &lt;span style=&#34;color: #f8f8f2&#34;&gt;$args&lt;/span&gt;&lt;span style=&#34;color: #f92672&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;{feed}&lt;/span&gt;&lt;span style=&#34;color: #f92672&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;delete_entry($entry);&lt;/span&gt;
        &lt;span style=&#34;color: #f8f8f2&#34;&gt;}&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2&#34;&gt;}&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2&#34;&gt;}&lt;/span&gt;

&lt;span style=&#34;color: #ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #75715e&#34;&gt;__END__&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;やはりperlは書き慣れんな。yamlを以下のようにして動作確認。&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;plugins:&lt;/span&gt;
  &lt;span style=&#34;color: #f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;module:&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;Subscription::Config&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2&#34;&gt;config:&lt;/span&gt;
      &lt;span style=&#34;color: #f8f8f2&#34;&gt;feed:&lt;/span&gt;
        &lt;span style=&#34;color: #f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;url:&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;http:&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;//&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;nobu666&lt;/span&gt;&lt;span style=&#34;color: #f92672&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;com&lt;/span&gt;&lt;span style=&#34;color: #f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;rss?feed&lt;/span&gt;&lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;rss2&lt;/span&gt;
  &lt;span style=&#34;color: #f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;module:&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;Filter::Rule&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2&#34;&gt;rule:&lt;/span&gt;
      &lt;span style=&#34;color: #f8f8f2&#34;&gt;module:&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;Deduped&lt;/span&gt;
      &lt;span style=&#34;color: #f8f8f2&#34;&gt;path:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;/tmp/&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;blog2mixi&lt;/span&gt;&lt;span style=&#34;color: #f92672&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;tmp&lt;/span&gt;
      &lt;span style=&#34;color: #f8f8f2&#34;&gt;compare_body:&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;1&lt;/span&gt;
  &lt;span style=&#34;color: #f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;module:&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;Filter::Reverse&lt;/span&gt;
  &lt;span style=&#34;color: #f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;module:&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;Filter::FindEnclosures&lt;/span&gt;
  &lt;span style=&#34;color: #f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;module:&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;Filter::FetchEnclosure&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2&#34;&gt;config:&lt;/span&gt;
      &lt;span style=&#34;color: #f8f8f2&#34;&gt;dir:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;/tmp/&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;fetch&lt;/span&gt;&lt;span style=&#34;color: #f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;image&lt;/span&gt;
  &lt;span style=&#34;color: #f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;module:&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;Filter::FormatText&lt;/span&gt;
  &lt;span style=&#34;color: #f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;module:&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;Filter::EntryFullText&lt;/span&gt;
  &lt;span style=&#34;color: #f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;module:&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;Filter::StripDeliciousDailyPost&lt;/span&gt;
  &lt;span style=&#34;color: #f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;module:&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;Publish::MixiDiary&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2&#34;&gt;config:&lt;/span&gt;
      &lt;span style=&#34;color: #f8f8f2&#34;&gt;username:&lt;/span&gt; &lt;span style=&#34;color: #960050; background-color: #1e0010&#34;&gt;メールアドレス&lt;/span&gt;
      &lt;span style=&#34;color: #f8f8f2&#34;&gt;password:&lt;/span&gt; &lt;span style=&#34;color: #960050; background-color: #1e0010&#34;&gt;パスワード&lt;/span&gt;
      &lt;span style=&#34;color: #f8f8f2&#34;&gt;interval:&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;10&lt;/span&gt;
      &lt;span style=&#34;color: #f8f8f2&#34;&gt;originally_link:&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;1&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>[memo] 異なるアーキテクチャ間でクロスコンパイル</title>
      <link>http://nobu666.com/2006/11/19/449.html</link>
      <pubDate>Sun, 19 Nov 2006 23:27:30 +0900</pubDate>
      
      <guid>http://nobu666.com/2006/11/19/449.html</guid>
      <description>&lt;p&gt;&lt;h4&gt;前提条件&lt;/h4&gt;
基本的には&lt;a href=&#34;http://www.gentoo.org/doc/ja/distcc.xml&#34; target=&#34;_blank&#34;&gt;Gentoo distcc ドキュメント&lt;/a&gt;・&lt;a href=&#34;http://www.gentoo.org/doc/ja/cross-compiling-distcc.xml&#34; target=&#34;_blank&#34;&gt;DistCC クロスコンパイルガイド&lt;/a&gt;、この2つのドキュメントの通り行う。気をつけなきゃいけないのは、「資源を借りる側」と「資源を貸す側」で若干設定が異なる点。ここでは借りる側はi686(192.168.0.4)、貸す側はamd64(192.168.0.3)とする。&lt;/p&gt;

&lt;p&gt;貸す側と借りる側で、gccのバージョンは同じであること。3.3.x同時はOKだが、3.3.xと3.2.xは混ぜないこと。&lt;/p&gt;

&lt;p&gt;また、資源を借りる側は一方的に借りるだけで、相互に助け合わない設定とした。これは、貸す側はサーバなので24時間稼働しているが、借りる側はノートなのでそうした。&lt;/p&gt;

&lt;p&gt;&lt;h4&gt;資源を貸す側の設定&lt;/h4&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;emerge distcc crossdev
vi /etc/make.conf
 &lt;span style=&#34;color: #f8f8f2&#34;&gt;MAKEOPTS&lt;/span&gt;&lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;quot;-j8&amp;quot;&lt;/span&gt; &lt;span style=&#34;color: #75715e&#34;&gt;#(CPUの数+1)*2 ここは全体じゃなくてサーバ単体で計算すべきなのかも。詳細不明…もしかしたら-j6が当たりなのかも?&lt;/span&gt;
 &lt;span style=&#34;color: #f8f8f2&#34;&gt;FEATURES&lt;/span&gt;&lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;quot;distcc&amp;quot;&lt;/span&gt;
 &lt;span style=&#34;color: #f8f8f2&#34;&gt;DISTCC_DIR&lt;/span&gt;&lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;quot;/var/tmp/.distcc&amp;quot;&lt;/span&gt;
 &lt;span style=&#34;color: #f8f8f2&#34;&gt;PORTDIR_OVERLAY&lt;/span&gt;&lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;quot;/usr/local/portage&amp;quot;&lt;/span&gt;
distcc-config --set-hosts &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;quot;localhost 192.168.0.4&amp;quot;&lt;/span&gt;
vi /etc/conf.d/distccd
 &lt;span style=&#34;color: #f8f8f2&#34;&gt;DISTCCD_OPTS&lt;/span&gt;&lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;quot;${&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;DISTCCD_OPTS&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;} --allow localhost --allow 192.168.0.4&amp;quot;&lt;/span&gt; &lt;span style=&#34;color: #75715e&#34;&gt;#--allow 192.168.0.0/24でも可&lt;/span&gt;
/etc/init.d/distcc start
rc-update add distcc default
crossdev -t i686
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;h4&gt;資源を借りる側の設定&lt;/h4&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;emerge distcc
vi /etc/make.conf
 &lt;span style=&#34;color: #f8f8f2&#34;&gt;MAKEOPTS&lt;/span&gt;&lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;quot;-j8&amp;quot;&lt;/span&gt; &lt;span style=&#34;color: #75715e&#34;&gt;#(CPUの数+1)*2&lt;/span&gt;
 &lt;span style=&#34;color: #f8f8f2&#34;&gt;FEATURES&lt;/span&gt;&lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;quot;distcc&amp;quot;&lt;/span&gt;
 &lt;span style=&#34;color: #f8f8f2&#34;&gt;DISTCC_DIR&lt;/span&gt;&lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;quot;/var/tmp/.distcc&amp;quot;&lt;/span&gt;
vi /etc/conf.d/distccd
 &lt;span style=&#34;color: #f8f8f2&#34;&gt;DISTCCD_OPTS&lt;/span&gt;&lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;quot;${&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;DISTCCD_OPTS&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;} --allow localhost&amp;quot;&lt;/span&gt; &lt;span style=&#34;color: #75715e&#34;&gt;#相互に助け合いたい場合は--allow 192.168.0.3を足すか--allow 192.168.0.0/24にする&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2&#34;&gt;cd&lt;/span&gt; /usr/lib/distcc/bin
rm c++ g++ gcc cc
&lt;span style=&#34;color: #f8f8f2&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;#!/bin/bash&amp;#39;&lt;/span&gt; &amp;gt; i686-pc-linux-gnu-wrapper
&lt;span style=&#34;color: #f8f8f2&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;exec /usr/lib/distcc/bin/sparc-unknown-linux-gnu-${0##*/} &amp;quot;$@&amp;quot;&amp;#39;&lt;/span&gt; &amp;gt;&amp;gt; i686-pc-linux-gnu-wrapper
chmod a+x i686-pc-linux-gnu-wrapper
ln -s i686-pc-linux-gnu-wrapper cc
ln -s i686-pc-linux-gnu-wrapper gcc
ln -s i686-pc-linux-gnu-wrapper g++
ln -s i686-pc-linux-gnu-wrapper c++
/etc/init.d/distcc start
rc-update add distcc default
&lt;span style=&#34;color: #f8f8f2&#34;&gt;export CC&lt;/span&gt;&lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;quot;i686-pc-linux-gnu-gcc&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;h4&gt;実際に試す&lt;/h4&gt;
借りる側から何か(それなりに時間のかかりそうなものを)emergeし、貸す側でtopコマンドで見てみる。distccというUSERでdistccやcc1というプロセスが見えれば成功している。当たり前だがコンパイルは速くなるが、configureやアーカイブのunpackは速くならないのであしからず。また、貸す側ではデフォルトでnice -15で実行されている。これは /etc/conf.d/distccdのDISTCCD_NICEで設定されているので、貸す側が暇なマシンなら変更してもいい。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>[memo][Gentoo] SNMP&#43;RRDtool&#43;cactiでサーバ監視</title>
      <link>http://nobu666.com/2006/11/12/442.html</link>
      <pubDate>Sun, 12 Nov 2006 12:03:34 +0900</pubDate>
      
      <guid>http://nobu666.com/2006/11/12/442.html</guid>
      <description>&lt;p&gt;インストールまでは上手くいったけど設定に嵌って酷い目にあった。&lt;/p&gt;

&lt;h4&gt;必要なものをインストールする&lt;/h4&gt;

&lt;p&gt;以下のものが必要。&lt;/p&gt;

&lt;ul&gt;
    &lt;li&gt;net-snmp&lt;/li&gt;
    &lt;li&gt;apache&lt;/li&gt;
    &lt;li&gt;php&lt;/li&gt;
    &lt;li&gt;mysql&lt;/li&gt;
    &lt;li&gt;rrdtool&lt;/li&gt;
    &lt;li&gt;cacti&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;さくっとemergeするわけだが、USEフラグに注意。cactiにはapache2/snmp、phpにはapache2/snmp/sockets/mysqlあたりが必要(gdとかxmlも必須なのか?よくわらかんがこの辺は/etc/make.confでデフォルトで付けている)。&lt;/p&gt;

&lt;h4&gt;初期設定&lt;/h4&gt;

&lt;p&gt;cacti用のデータベースとユーザを作成し、付属のスクリプトでテーブルを作成する。&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;mysqladmin -u root create cacti -p
mysql cacti -u root -p &amp;gt; /var/www/localhost/htdocs/cacti/cacti.sql
mysql -u root mysql -p -e&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;quot;GRANT ALL ON cacti.* TO cactiuser@localhost IDENTIFIED BY &amp;#39;p4ssw0rd&amp;#39;&amp;quot;&lt;/span&gt;
mysql -u root mysql -p -e&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;quot;flush privileges&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;次にphpのconfigファイルを、今設定したものに合わせて書き換える。&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;vi /var/www/localhost/htdocs/cacti/include/config.php
 &lt;span style=&#34;color: #f8f8f2&#34;&gt;$database_username&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;quot;cactiuser&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;;&lt;/span&gt;
 &lt;span style=&#34;color: #f8f8f2&#34;&gt;$database_password&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;quot;p4ssw0rd&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;cron実行用のシステムアカウント作成とパーミッション変更&lt;/h4&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;useradd -g apache -d /dev/null -s /bin/false -c cacti cacti
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ホームディレクトリを/dev/null、ログインシェルを/bin/falseにすることで、cactiというユーザでログインできないようにする。この辺は適当に手を抜いてrootでやったりすると怖いので忘れずに。次にcactiユーザでデータの読み書きするためにパーミションを変える。&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;chown -R cacti:apache /var/www/localhost/htdocs/cacti
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;全部変えちゃったけどrraとlogディレクトリだけでいいかも。未検証。&lt;/p&gt;

&lt;h4&gt;cronの設定&lt;/h4&gt;

&lt;p&gt;適当なタイミングでスクリプトをブン回す。とりあえず5分間隔に設定。&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;vi /etc/crontab
 */5 * * * * cacti   /usr/bin/php /var/www/localhost/htdocs/cacti/cmd.php &amp;gt; /dev/null 2&amp;gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;&amp;amp;&lt;/span&gt;1
&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;cactiの設定&lt;/h4&gt;

&lt;p&gt;ブラウザから &lt;a href=&#34;http://hostname/cacti/&#34;&gt;http://hostname/cacti/&lt;/a&gt; にアクセス。デフォルトのユーザとパスワードはadmin/admin。ウィザードが始まるがNext押していけばいい。adminのパスワードは適当なものに変更する。&lt;/p&gt;

&lt;p&gt;色々設定するところがあるが、一番下にある参考URLらへんを参照。&lt;/p&gt;

&lt;p&gt;ここでrrdtoolからACCESS DENIEDと言われてグラフが上手く表示されなかった。よくわからんがcactiでadminじゃなくてcactiというユーザを作り、User Management→cacti→Graph PermissionsでDenyをAllowにお変更してSave。Graph Managementからなんかグラフを選んで、右上の*Turn On Graph Debug Mode.をクリックするとログが見えるようになるので押してみる。今度は&amp;rsquo;rra/localhost_load_1min_5.rrd&amp;rsquo;: No such file or directoryとか怒られる。&lt;/p&gt;

&lt;p&gt;見てみると確かにrraの下が空っぽなのでダメらしい。/var/www/localhost/htdocs/cacti/cmd.phpを実行してもエラーらしきものは出ておらず。しばらくココで嵌ったが、/var/www/localhost/htdocs/cacti/poller.phpを実行すればOKだった。1回目は前のデータがないので怒られるが、もう1度やると問題なく実行された。そのあとcactiからはちゃんと見えるようになった。&lt;/p&gt;

&lt;h4&gt;参考URL&lt;/h4&gt;

&lt;ul&gt;
    &lt;li&gt;&lt;a href=&#34;http://www.boreas.dti.ne.jp/~mishiro/&#34; target=&#34;_blank&#34;&gt;Net-SNMPの設定方法&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&#34;http://net-snmp.sourceforge.net/&#34; target=&#34;_blank&#34;&gt;net-snmp&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&#34;http://www.photonway.net/AboutRrdtool.html&#34; target=&#34;_blank&#34;&gt;About Rrdtool&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&#34;http://www.boreas.dti.ne.jp/~mishiro/rrdtool/&#34; target=&#34;_blank&#34;&gt;RRDtoolのすすめ&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&#34;http://cacti.net/&#34; target=&#34;_blank&#34;&gt;cacti&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&#34;http://cacti.loaded.jp/&#34; target=&#34;_blank&#34;&gt;グラフツールcactiとは?&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&#34;http://www.stackasterisk.jp/tech/systemManagement/snmp01_01.jsp&#34; target=&#34;_blank&#34;&gt;【連載 】SNMPによるネットワークシステムの監視&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&#34;http://www.aconus.com/~oyaji/suse9.3/cacti_linux1.htm&#34; target=&#34;_blank&#34;&gt;RRDTool+Cactiによるサーバ監視(Linux編)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>[memo] GentooにPlaggerをインストール</title>
      <link>http://nobu666.com/2006/11/11/439.html</link>
      <pubDate>Sat, 11 Nov 2006 01:29:02 +0900</pubDate>
      
      <guid>http://nobu666.com/2006/11/11/439.html</guid>
      <description>&lt;p&gt;Gentooにはg-cpanという素晴らしいものがあるのだが、そこはあえて使わずにいく。というかなんか知らないけど上手くいかなかったので、仕方なく手動で入れたとも言う。とりあえず自宅サーバと言うことで、サックリrootになって入れることにする。そのほうが簡単。以前レンタルサーバで悩んだのがウソのようだ。ちゃんとログを取ってないので曖昧な記憶でメモ。&lt;/p&gt;

&lt;h4&gt;準備&lt;/h4&gt;

&lt;p&gt;別段何もない。&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;perl -MCPAN -e shell
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;基本全部デフォルトのままENTER押してりゃよし。Gentooの場合、cpanでガンガン入れる前にまず&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;emerge expat
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;これをやっておく。次にCPANのConfigを弄る。&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;vi&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;/usr/&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;lib&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;/perl5/&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;5.8.8&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;/CPAN/&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;Config&lt;/span&gt;&lt;span style=&#34;color: #f92672&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;pm&lt;/span&gt;
 &lt;span style=&#34;color: #f8f8f2&#34;&gt;$CPAN::Config&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;{&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;build_cache&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;q[100]&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;build_dir&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;q[/root/.cpan/build]&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;bzip2&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;q[/bin/bzip2]&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;cache_metadata&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;q[1]&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;check_sigs&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;q[0]&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;colorize_output&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;q[0]&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;commandnumber_in_prompt&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;q[1]&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;cpan_home&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;q[/root/.cpan]&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;curl&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;q[/usr/bin/curl]&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;ftp&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;q[/usr/bin/ftp]&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;ftp_passive&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;q[1]&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;ftp_proxy&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;q[]&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;getcwd&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;q[cwd]&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;gpg&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;q[]&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;gzip&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;q[/bin/gzip]&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;histfile&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;q[/root/.cpan/histfile]&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;histsize&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;q[100]&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;http_proxy&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;q[]&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;inactivity_timeout&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;q[0]&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;index_expire&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;q[1]&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;inhibit_startup_message&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;q[0]&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;keep_source_where&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;q[/root/.cpan/sources]&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;lynx&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;q[]&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;make&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;q[/usr/bin/make]&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;make_arg&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;q[]&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;make_install_arg&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;q[]&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;make_install_make_command&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;q[/usr/bin/make]&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;makepl_arg&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;q[]&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;mbuild_arg&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;q[]&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;mbuild_install_arg&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;q[]&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;mbuild_install_build_command&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;q[./Build]&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;mbuildpl_arg&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;q[]&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;ncftp&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;q[]&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;ncftpget&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;q[]&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;no_proxy&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;q[]&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;pager&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;q[lv -Ou8 -c]&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;prefer_installer&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;q[EUMM]&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;prerequisites_policy&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;q[ask]&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;scan_cache&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;q[atstart]&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;shell&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;q[/bin/zsh]&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;show_upload_date&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;q[1]&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;tar&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;q[/usr/bin/tar]&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;term_is_latin&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;q[1]&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;term_ornaments&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;q[1]&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;test_report&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;q[0]&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;unzip&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;q[/usr/bin/unzip]&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;urllist&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;q[ftp://ftp.kddilabs.jp/CPAN/]&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;],&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;wget&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;q[/usr/bin/wget]&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;,&lt;/span&gt;
 &lt;span style=&#34;color: #f8f8f2&#34;&gt;};&lt;/span&gt;
 &lt;span style=&#34;color: #ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;;&lt;/span&gt;
 &lt;span style=&#34;color: #75715e&#34;&gt;__END__&lt;/span&gt;

&lt;span style=&#34;color: #75715e&#34;&gt;cpan -i Bundle::CPAN&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;h4&gt;CPANモジュールのインストール&lt;/h4&gt;
&lt;a href=&#34;http://subtech.g.hatena.ne.jp/otsune/20060816/PlaggerCPAN&#34; target=&#34;_blank&#34;&gt;Bundle::CPANとPlaggerに依存するモジュール（メモ）&lt;/a&gt;に従って進める。書いてあるとおり、TemplateとEncode::Detectはまともには入らないっぽいので諦めてforce installで。別段不都合はないので。&lt;/p&gt;

&lt;p&gt;なんかRDF::Coreが上手く入らなくて困った記憶がある。emerge expatしてないせいだった、という記憶もあるが…ちょっと覚えてない。でもコマンドの履歴に以下のものが残っていた。&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;wget http://ftp.yz.yamagata-u.ac.jp/pub/lang/cpan/modules/by-module/RDF/DPOKORNY/RDF-Core-0.50.tar.gz
tar -zxvf RDF-Core-0.50.tar.gz
&lt;span style=&#34;color: #f8f8f2&#34;&gt;cd &lt;/span&gt;RDF-Core-0.50
perl Makefile.PL
make
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;手動で入れたっぽい。若年アルツで覚えてない。まぁとりあえず頑張って入れて、cpanシェルでtest Plaggerが通るまで頑張る。通ったらinstall Plagger。&lt;/p&gt;

&lt;p&gt;&lt;h4&gt;リポジトリから最新取得&lt;/h4&gt;
subversionを使ってリポジトリから最新版を持ってきてmakeする。&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;svn co http://svn.bulknews.net/repos/plagger/trunk/plagger
&lt;span style=&#34;color: #f8f8f2&#34;&gt;cd &lt;/span&gt;plagger
perl Makefile.PL
make
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ここまで行ったら出来たも同然。Plagger3大罠の1つである、assetsのコピーを忘れないうちにやっておく。svnで最新版を入れたディレクトリのassets以下に、　.cpan/build/Plagger-x.x.xx/assets/plugins/Publish-Gmail/gmail_notify.tt をコピっておく。yamlのglobalでassets_pathを指定するのも忘れずに。ちなみにyamlのサンプルは .cpan/build/Plagger-x.x.xx/examples 以下に入っているので、適当な場所にコピって編集すべし。&lt;/p&gt;

&lt;p&gt;まぁ何が言いたいかって言うとレン鯖だと非常に苦労したインストールも、自宅鯖なら超簡単だぜってことです。gmailのメール送信量制限も、自宅鯖なら無関係。cacheもレン鯖だと、HDDが1Gくらいしかないので気にしなきゃいけないけど自宅鯖にはほぼ無関係。足りなくなったら増やせばイイだけだし。Plagger自体それなりに負荷があるので、レン鯖の場合は30分単位くらいで回さないと怒られそうなのだが、それを気にしなくていいのが一番でかい。もう5分とかで回してる。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>[memo] rep2をSSL&#43;Basic認証で使う</title>
      <link>http://nobu666.com/2006/11/04/429.html</link>
      <pubDate>Sat, 04 Nov 2006 02:24:07 +0900</pubDate>
      
      <guid>http://nobu666.com/2006/11/04/429.html</guid>
      <description>&lt;p&gt;通勤時の電車の中では本を読んでいるか、暇つぶしに2ch見てるわけだが。どうせ携帯で見るなら自宅サーバのリソースも余ってることだし有効活用したい。そんなわけで&lt;a href=&#34;http://akid.s17.xrea.com/&#34; target=&#34;_blank&#34;&gt;rep2&lt;/a&gt;を使うことにした。&lt;/p&gt;

&lt;p&gt;&lt;h4&gt;インストール&lt;/h4&gt;
とりあえずダウンロードして、/var/www/localhost/rep2とかに置く。apacheは当然SSL有効でコンパイルしておくこと。phpはやたらに使用可能なフラグが多いのでメモっておく。&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;emerge -pv php

These are the packages that would be merged, in order:

Calculating dependencies... &lt;span style=&#34;color: #66d9ef&#34;&gt;done&lt;/span&gt;!
&lt;span style=&#34;color: #f92672&#34;&gt;[&lt;/span&gt;ebuild   R   &lt;span style=&#34;color: #f92672&#34;&gt;]&lt;/span&gt; dev-lang/php-5.1.6-r6  &lt;span style=&#34;color: #f8f8f2&#34;&gt;USE&lt;/span&gt;&lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;quot;apache2 bzip2 cjk cli crypt curl curlwrappers gd iconv mysql ncurses nls pcre readline sasl session spell ssl threads unicode xml xmlrpc zlib (-adabas) -apache -bcmath -berkdb (-birdstep) -calendar -cdb -cgi -concurrentmodphp -ctype -db2 -dbase (-dbmaker) -debug -discard-path -doc (-empress) (-empress-bcs) (-esoob) -exif -fastbuild (-fdftk) (-filepro) (-firebird) -flatfile -force-cgi-redirect (-frontbase) -ftp -gd-external -gdbm -gmp -hardenedphp -hash -hyperwave-api -imap (-informix) -inifile -interbase -iodbc -ipv6 -java-external -kerberos -ldap -libedit -mcve -memlimit -mhash -ming -msql -mssql -mysqli -oci8 (-oci8-instant-client) -odbc -pcntl -pdo -pdo-external -pic -posix -postgres -qdbm -recode -reflection -sapdb -sharedext -sharedmem -simplexml -snmp -soap -sockets (-solid) -spl -sqlite (-sybase) (-sybase-ct) -sysvipc -tidy -tokenizer -truetype -vm-goto -vm-switch -wddx -xmlreader -xmlwriter -xpm -xsl -yaz -zip&amp;quot;&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;0&lt;/span&gt; kB
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;rep2はPEARモジュールのいくつかが必須なので、PEARもと必須モジュールを入れる。eixで見つからなかったものはpearコマンドで入れ、見つかったものはemergeで入れた。&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;emerge PEAR-PEAR
pear install Net_UserAgent_Mobile-beta
pear install PHP_Compat
emerge PEAR-HTTP_Request
emerge PEAR-Pager
emerge PEAR-File
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;h4&gt;phpの設定&lt;/h4&gt;
/etc/php/apache2-php5/php.iniの次のコメントアウトを外す。&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;[mbstring]
mbstring.internal_encoding = EUC-JP
mbstring.http_input = auto
mbstring.http_output = EUC-JP
mbstring.detect_order = auto
mbstring.substitute_character = none;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;h4&gt;apacheの設定&lt;/h4&gt;
SSLを使うため、認証局と証明書が必要。&lt;a href=&#34;http://nobu666.com/2006/10/29/000423.html&#34;&gt;[修正版][memo] postfix + dovecotでSMTP AUTH &amp;amp; IMAPなメールサーバを立ち上げる&lt;/a&gt;で作成したものがあるのでそれを流用する。&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;cp -p /etc/ssl/postfix/server.crt /etc/apache2/ssl/ 
cp -p /etc/ssl/postfix/server.key /etc/apache2/ssl/
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;次にBasic認証に使う.htaccessをフォルダで上書きできるようにしておくため、/etc/apache2/modules.d/41_mod_ssl.default-vhost.confと/etc/apache2/vhosts.d/00_default_vhost.confの&lt;directory &#34;/var/www/localhost/htdocs&#34;&gt;部分を以下のように設定する。&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span style=&#34;color: #f92672&#34;&gt;&amp;lt;directory&lt;/span&gt; &lt;span style=&#34;color: #960050; background-color: #1e0010&#34;&gt;&amp;quot;/var/www/localhost/htdocs&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #f92672&#34;&gt;&amp;gt;&lt;/span&gt;
    Options FollowSymLinks
    AllowOverride AuthConfig
&lt;span style=&#34;color: #f92672&#34;&gt;&amp;lt;/directory&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;h4&gt;.htaccessの設定&lt;/h4&gt;
/var/www/localhost/htdocs/rep2に.htaccessを作成(サイト全体に認証をかけたいならhtdocsの下でも可)。&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;vi /var/www/localhost/htdocs/rep2/.htaccess
 AuthName &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;quot;User Authentication Required&amp;quot;&lt;/span&gt;
 AuthType Basic
 Require valid-user
 AuthUserFile /etc/apache2/.htpasswd
htpasswd2 -c /etc/apache2/.htpasswd ユーザ名
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;h4&gt;apacheの起動パラメータ&lt;/h4&gt;
gentooのapacheは、有効にしたいモジュールを明示しないといけないので、/etc/conf.d/apache2を修正。&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;vi /etc/conf.d/apache2
 &lt;span style=&#34;color: #f8f8f2&#34;&gt;APACHE2_OPTS&lt;/span&gt;&lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;quot;-D SSL -D PHP5 -D DEFAULT_VHOST -D SSL_DEFAULT_VHOST&amp;quot;&lt;/span&gt;
/etc/init.d/apache2 restart
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;これで　https://ホスト名:443/rep2/　に行けばユーザ名とパスワードが聞かれるはず。念のため携帯からもアクセスして問題なく認証できれば万事OK。ただ携帯でパスワードを入力するのは面倒なので、どうにか携帯の固有IDでパスできないか調べ中。auだとHTTP_X_UP_SUBNOで取れるみたいなんだが…&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>[memo] GentooでUPS(APC ES 500)を使う</title>
      <link>http://nobu666.com/2006/10/30/424.html</link>
      <pubDate>Mon, 30 Oct 2006 01:29:11 +0900</pubDate>
      
      <guid>http://nobu666.com/2006/10/30/424.html</guid>
      <description>&lt;p&gt;&lt;a href=&#34;http://www.amazon.co.jp/exec/obidos/ASIN/B0000AG7HB/realbeat-22/ref=nosim/&#34; name=&#34;amazletlink&#34; target=&#34;_blank&#34;&gt;&lt;img src=&#34;http://images-jp.amazon.com/images/P/B0000AG7HB.09.MZZZZZZZ.jpg&#34; alt=&#34;APC ES 500&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Amazonで\7,000ちょっとという値段だったので、購入したのが届いた。流石に24時間稼働だとUPSがないと怖い。今年の雷で瞬断も多くあったので。付属のPowerCuteはWindowsとMacOS Xと商用Linuxにしか対応していないので自力でどうにかする方法をメモ。&lt;/p&gt;

&lt;h4&gt;準備と接続、認識確認&lt;/h4&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;emerge apcupsd
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;なにはなくともコレがないと始まらない。とりあえずインストールしたら一旦シャットダウンしてコンセントをUPSにつなぎ変え、付属のUSB通信ケーブルでUPSとサーバを接続して再起動。再起動したらdmesgを見てサーバがES500を認識しているか確認。&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;usbcore: registered new driver hiddev
hiddev0: USB HID v1.10 Device [APC APC ES 500 FW:803.p6.A USB FW:p6] on usb-0000:00:10.2-2
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;上記のようなメッセージがあれば問題ない。が、&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;es500 hid device not claimed
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;とか出てたら認識していない。俺の場合は思い切り認識していなかった。要するにまたカーネル再構築。だがもう手慣れたモンなのでサクサクと再構築する。こういうときはマシンパワーがあると非常に楽だ。お約束の以下の呪文を唱える。&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;cd&lt;/span&gt; /usr/src/linux
make menuconfig
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;そして今の設定をLOADして、以下のところにチェックを付けて保存。&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;Device Drivers ---&amp;gt;
    USB Support ---&amp;gt;
        /dev/hiddev raw HID device support
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;またお約束の呪文。&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;make &lt;span style=&#34;color: #f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; make modules_install
cp arch/x86_64/boot/bzImage /boot/なんか適当な名前
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;そしたら/boot/grub/grub.confを編集して再起動すればいい。今度はちゃんと認識されているはず。念のためapcaccess statusとやってエラーが出ないことを確認する。&lt;/p&gt;

&lt;h4&gt;設定と動作確認&lt;/h4&gt;

&lt;p&gt;次はapcupsdの設定を行う。&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;cat /etc/apcupsd/apcupsd.conf
UPSCABLE usb
UPSTYPE usb
DEVICE
LOCKFILE /var/lock
ONBATTERYDELAY 6
BATTERYLEVEL 5
MINUTES 3
TIMEOUT 10
ANNOY 300
ANNOYDELAY 60
NOLOGON disable
KILLDELAY 0
NETSERVER on
NISIP 0.0.0.0
NISPORT 3551
EVENTSFILE /var/log/apcupsd.events
EVENTSFILEMAX 10
UPSCLASS standalone
UPSMODE disable
STATTIME 0
STATFILE /var/log/apcupsd.status
LOGSTATS off
DATATIME 0
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;殆どデフォルト。TIMEOUTに関しては動作確認のため10にした。これは10だと電源断から10秒でシャットダウンするということ。実際にapcupsdを動かして試してみる。&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;/etc/init.d/apcupsd start
rc-update add apcupsd default
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;思い切ってUPSのコンセントをぶっこ抜いてみる。ピーピーピーと警告音が鳴り、10秒後にシャットダウン処理が走れば成功。忘れないようにTIMEOUTは0にしておくこと。ここを0にしておくとUPS側のバッテリーで頑張ってくれるようになる。どのくらい頑張るかはBATTERYLEVELとMINUTESで決まる。BATTERYLEVELはバッテリ残量が残り何%になったらシャットダウンするかで、MINUTESは残り時間何分でシャットダウンするか。どちらかの条件を満たすとシャットダウンされる。お好みで変える。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>[修正版][memo] postfix &#43; dovecotでSMTP AUTH &amp; IMAPなメールサーバを立ち上げる</title>
      <link>http://nobu666.com/2006/10/29/423.html</link>
      <pubDate>Sun, 29 Oct 2006 17:42:48 +0900</pubDate>
      
      <guid>http://nobu666.com/2006/10/29/423.html</guid>
      <description>&lt;p&gt;&lt;a href=&#34;http://nobu666.com/2006/10/25/000420.html&#34;&gt;[memo] postfix + dovecotでSMTP AUTH &amp;amp; IMAPなメールサーバを立ち上げる&lt;/a&gt;があまり正しくないので修正版。&lt;/p&gt;

&lt;p&gt;&lt;h4&gt;ssmtpの削除&lt;/h4&gt;
Gentooではいきなりpostfixを入れようとしても、デフォルトでssmtpが入っていてblockされるのでssmtpを消すのが先決。&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;emerge -C ssmtp
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;h4&gt;postfixとdovecotのインストール&lt;/h4&gt;
Gentooの基本だけど、emergeするときはemerge -pvでどんなフラグが有効になるか必ず確認。必要ないならpackage.useで外す。あとsaslが必要なのでこれは付けておく。あとなんでかわからないけどpostfixにsaslを付けるとついてくるcyrus-saslで、gdbmやcryptをUSEするとコンパイルに失敗したので外した。&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;emerge -pv postfix dovecot
&lt;span style=&#34;color: #f8f8f2&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;quot;mmail-mta/postfix -mysql sasl&amp;quot;&lt;/span&gt; &amp;gt;&amp;gt; /etc/portage/package.use
&lt;span style=&#34;color: #f8f8f2&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;quot;dev-libs/cyrus-sasl -mysql -java -gdbm -crypt&amp;quot;&lt;/span&gt; &amp;gt;&amp;gt; /etc/portage/package.use
emerge postfix dovecot
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;h4&gt;オレオレ認証局の作成&lt;/h4&gt;
Gentooでの方法なので他のディストリではパスが違うようなので注意。&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;mkdir /etc/certs
chmod &lt;span style=&#34;color: #ae81ff&#34;&gt;700&lt;/span&gt; /etc/certs 
&lt;span style=&#34;color: #f8f8f2&#34;&gt;cd&lt;/span&gt; /etc/certs
cp /etc/ssl/misc/CA.pl .
perl ./CA.pl -newca
CA certificate filename &lt;span style=&#34;color: #f92672&#34;&gt;(&lt;/span&gt;or enter to create&lt;span style=&#34;color: #f92672&#34;&gt;)&lt;/span&gt;
&lt;span style=&#34;color: #f92672&#34;&gt;(&lt;/span&gt;ENTER&lt;span style=&#34;color: #f92672&#34;&gt;)&lt;/span&gt;
Making CA certificate ...
Generating a &lt;span style=&#34;color: #ae81ff&#34;&gt;1024&lt;/span&gt; bit RSA private key
..................................++++++
.......................++++++
writing new private key to &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;./demoCA/private/cakey.pem&amp;#39;&lt;/span&gt;
Enter PEM pass phrase:&lt;span style=&#34;color: #f92672&#34;&gt;(&lt;/span&gt;パスフレーズを入力&lt;span style=&#34;color: #f92672&#34;&gt;)&lt;/span&gt;
Verifying - Enter PEM pass phrase:&lt;span style=&#34;color: #f92672&#34;&gt;(&lt;/span&gt;同じパスフレーズをもう一度入力&lt;span style=&#34;color: #f92672&#34;&gt;)&lt;/span&gt;
-----
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;.&amp;#39;&lt;/span&gt;, the field will be left blank.
-----
Country Name &lt;span style=&#34;color: #f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;2&lt;/span&gt; letter code&lt;span style=&#34;color: #f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;[&lt;/span&gt;AU&lt;span style=&#34;color: #f92672&#34;&gt;]&lt;/span&gt;:JP
State or Province Name &lt;span style=&#34;color: #f92672&#34;&gt;(&lt;/span&gt;full name&lt;span style=&#34;color: #f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;[&lt;/span&gt;Some-State&lt;span style=&#34;color: #f92672&#34;&gt;]&lt;/span&gt;:Kanagawa
Locality Name &lt;span style=&#34;color: #f92672&#34;&gt;(&lt;/span&gt;eg, city&lt;span style=&#34;color: #f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;[]&lt;/span&gt;:Yokohama
Organization Name &lt;span style=&#34;color: #f92672&#34;&gt;(&lt;/span&gt;eg, company&lt;span style=&#34;color: #f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;[&lt;/span&gt;Internet Widgits Pty Ltd&lt;span style=&#34;color: #f92672&#34;&gt;]&lt;/span&gt;:Private
Organizational Unit Name &lt;span style=&#34;color: #f92672&#34;&gt;(&lt;/span&gt;eg, section&lt;span style=&#34;color: #f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;[]&lt;/span&gt;:Private
Common Name &lt;span style=&#34;color: #f92672&#34;&gt;(&lt;/span&gt;eg, YOUR name&lt;span style=&#34;color: #f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;[]&lt;/span&gt;:nobu666.fam.cx
Email Address &lt;span style=&#34;color: #f92672&#34;&gt;[]&lt;/span&gt;:root@nobu666.fam.cx

Please enter the following &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;extra&amp;#39;&lt;/span&gt; attributes
to be sent with your certificate request
A challenge password &lt;span style=&#34;color: #f92672&#34;&gt;[]&lt;/span&gt;:&lt;span style=&#34;color: #f92672&#34;&gt;(&lt;/span&gt;ENTER&lt;span style=&#34;color: #f92672&#34;&gt;)&lt;/span&gt;
An optional company name &lt;span style=&#34;color: #f92672&#34;&gt;[]&lt;/span&gt;:&lt;span style=&#34;color: #f92672&#34;&gt;(&lt;/span&gt;ENTER&lt;span style=&#34;color: #f92672&#34;&gt;)&lt;/span&gt;
Using configuration from /etc/ssl/openssl.cnf
Enter pass phrase &lt;span style=&#34;color: #66d9ef&#34;&gt;for&lt;/span&gt; ./demoCA/private/cakey.pem:
Check that the request matches the signature
Signature ok
Certificate Details:
 &lt;span style=&#34;color: #f92672&#34;&gt;(&lt;/span&gt;略&lt;span style=&#34;color: #f92672&#34;&gt;)&lt;/span&gt;
Certificate is to be certified &lt;span style=&#34;color: #66d9ef&#34;&gt;until&lt;/span&gt; Oct &lt;span style=&#34;color: #ae81ff&#34;&gt;28&lt;/span&gt; 06:15:58 &lt;span style=&#34;color: #ae81ff&#34;&gt;2009&lt;/span&gt; GMT &lt;span style=&#34;color: #f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;1095&lt;/span&gt; days&lt;span style=&#34;color: #f92672&#34;&gt;)&lt;/span&gt;

Write out database with &lt;span style=&#34;color: #ae81ff&#34;&gt;1&lt;/span&gt; new entries
Data Base Updated
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;h4&gt;クライアント用CA証明書とサーバ用CA証明書を作成&lt;/h4&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;cd&lt;/span&gt; /etc/certs/demoCA
openssl x509 -inform pem -in cacert.pem -outform der -out cacert.der 
openssl x509 -in ./cacert.pem -out ./cacert.crt
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;h4&gt;デジタル証明書のリクエストファイルを作成&lt;/h4&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;cd&lt;/span&gt; /etc/certs
perl ./CA.pl -newreq-nodes
Generating a &lt;span style=&#34;color: #ae81ff&#34;&gt;1024&lt;/span&gt; bit RSA private key
...++++++
...............................................................................................................++++++
writing new private key to &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;newkey.pem&amp;#39;&lt;/span&gt;
-----
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;.&amp;#39;&lt;/span&gt;, the field will be left blank.
-----
Country Name &lt;span style=&#34;color: #f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;2&lt;/span&gt; letter code&lt;span style=&#34;color: #f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;[&lt;/span&gt;AU&lt;span style=&#34;color: #f92672&#34;&gt;]&lt;/span&gt;:JP
State or Province Name &lt;span style=&#34;color: #f92672&#34;&gt;(&lt;/span&gt;full name&lt;span style=&#34;color: #f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;[&lt;/span&gt;Some-State&lt;span style=&#34;color: #f92672&#34;&gt;]&lt;/span&gt;:Kanagawa
Locality Name &lt;span style=&#34;color: #f92672&#34;&gt;(&lt;/span&gt;eg, city&lt;span style=&#34;color: #f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;[]&lt;/span&gt;:Yokohama
Organization Name &lt;span style=&#34;color: #f92672&#34;&gt;(&lt;/span&gt;eg, company&lt;span style=&#34;color: #f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;[&lt;/span&gt;Internet Widgits Pty Ltd&lt;span style=&#34;color: #f92672&#34;&gt;]&lt;/span&gt;:nobu666.fam.cx
Organizational Unit Name &lt;span style=&#34;color: #f92672&#34;&gt;(&lt;/span&gt;eg, section&lt;span style=&#34;color: #f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;[]&lt;/span&gt;:Admin
Common Name &lt;span style=&#34;color: #f92672&#34;&gt;(&lt;/span&gt;eg, YOUR name&lt;span style=&#34;color: #f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;[]&lt;/span&gt;:nobu666.fam.cx
Email Address &lt;span style=&#34;color: #f92672&#34;&gt;[]&lt;/span&gt;:root@nobu666.fam.cx

Please enter the following &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;extra&amp;#39;&lt;/span&gt; attributes
to be sent with your certificate request
A challenge password &lt;span style=&#34;color: #f92672&#34;&gt;[]&lt;/span&gt;:&lt;span style=&#34;color: #f92672&#34;&gt;(&lt;/span&gt;ENTER&lt;span style=&#34;color: #f92672&#34;&gt;)&lt;/span&gt;
An optional company name &lt;span style=&#34;color: #f92672&#34;&gt;[]&lt;/span&gt;:&lt;span style=&#34;color: #f92672&#34;&gt;(&lt;/span&gt;ENTER&lt;span style=&#34;color: #f92672&#34;&gt;)&lt;/span&gt;
Request is in newreq.pem, private key is in newkey.pem
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;h4&gt;リクエストファイルからX.509サーバ証明書の作成と署名&lt;/h4&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;perl ./CA.pl -sign
Using configuration from /etc/ssl/openssl.cnf
Enter pass phrase &lt;span style=&#34;color: #66d9ef&#34;&gt;for&lt;/span&gt; ./demoCA/private/cakey.pem:
Check that the request matches the signature
Signature ok
Certificate Details:
        Serial Number:
            ce:db:05:2a:6a:dc:75:17
        Validity
            Not Before: Oct &lt;span style=&#34;color: #ae81ff&#34;&gt;29&lt;/span&gt; 06:51:11 &lt;span style=&#34;color: #ae81ff&#34;&gt;2006&lt;/span&gt; GMT
            Not After : Oct &lt;span style=&#34;color: #ae81ff&#34;&gt;29&lt;/span&gt; 06:51:11 &lt;span style=&#34;color: #ae81ff&#34;&gt;2007&lt;/span&gt; GMT
        Subject:
            &lt;span style=&#34;color: #f8f8f2&#34;&gt;countryName&lt;/span&gt;               &lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt; JP
            &lt;span style=&#34;color: #f8f8f2&#34;&gt;stateOrProvinceName&lt;/span&gt;       &lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt; Kanagawa
            &lt;span style=&#34;color: #f8f8f2&#34;&gt;localityName&lt;/span&gt;              &lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt; Yokohama
            &lt;span style=&#34;color: #f8f8f2&#34;&gt;organizationName&lt;/span&gt;          &lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt; nobu666.fam.cx
            &lt;span style=&#34;color: #f8f8f2&#34;&gt;organizationalUnitName&lt;/span&gt;    &lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt; Admin
            &lt;span style=&#34;color: #f8f8f2&#34;&gt;commonName&lt;/span&gt;                &lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt; nobu666.fam.cx
            &lt;span style=&#34;color: #f8f8f2&#34;&gt;emailAddress&lt;/span&gt;              &lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt; root@nobu666.fam.cx
        X509v3 extensions:
            X509v3 Basic Constraints:
                CA:FALSE
            Netscape Comment:
                OpenSSL Generated Certificate
            X509v3 Subject Key Identifier:
                7B:0E:46:62:02:FB:B6:A6:05:DC:DE:75:2E:2D:5A:29:5D:31:79:F8
            X509v3 Authority Key Identifier:
                keyid:A7:51:EC:0A:BD:B6:70:68:A5:01:ED:8E:76:1F:FE:0C:4D:B2:A0:19

Certificate is to be certified &lt;span style=&#34;color: #66d9ef&#34;&gt;until&lt;/span&gt; Oct &lt;span style=&#34;color: #ae81ff&#34;&gt;29&lt;/span&gt; 06:51:11 &lt;span style=&#34;color: #ae81ff&#34;&gt;2007&lt;/span&gt; GMT &lt;span style=&#34;color: #f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;365&lt;/span&gt; days&lt;span style=&#34;color: #f92672&#34;&gt;)&lt;/span&gt;
Sign the certificate? &lt;span style=&#34;color: #f92672&#34;&gt;[&lt;/span&gt;y/n&lt;span style=&#34;color: #f92672&#34;&gt;]&lt;/span&gt;:y


&lt;span style=&#34;color: #ae81ff&#34;&gt;1&lt;/span&gt; out of &lt;span style=&#34;color: #ae81ff&#34;&gt;1&lt;/span&gt; certificate requests certified, commit? &lt;span style=&#34;color: #f92672&#34;&gt;[&lt;/span&gt;y/n&lt;span style=&#34;color: #f92672&#34;&gt;]&lt;/span&gt;y
Write out database with &lt;span style=&#34;color: #ae81ff&#34;&gt;1&lt;/span&gt; new entries
Data Base Updated
Signed certificate is in newcert.pem

openssl x509 -in newcert.pem -out server.crt
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;h4&gt;postfix用にシンボリックリンクを張る&lt;/h4&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;ln -sf /etc/certs/server.crt /etc/ssl/postfix/server.crt
ln -sf /etc/certs/newkey.pem /etc/ssl/postfix/server.key
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;h4&gt;postfixの設定&lt;/h4&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;vi /etc/postfix/main.cf

&lt;span style=&#34;color: #f8f8f2&#34;&gt;queue_directory&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt; /var/spool/postfix
&lt;span style=&#34;color: #f8f8f2&#34;&gt;command_directory&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt; /usr/sbin
&lt;span style=&#34;color: #f8f8f2&#34;&gt;daemon_directory&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt; /usr/lib/postfix
&lt;span style=&#34;color: #f8f8f2&#34;&gt;mail_owner&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt; postfix
&lt;span style=&#34;color: #f8f8f2&#34;&gt;myhostname&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt; nobu666.fam.cx
&lt;span style=&#34;color: #f8f8f2&#34;&gt;mydomain&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt; nobu666.fam.cx
&lt;span style=&#34;color: #f8f8f2&#34;&gt;myorigin&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;$mydomain&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2&#34;&gt;inet_interfaces&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt; all
&lt;span style=&#34;color: #f8f8f2&#34;&gt;mydestination&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;$myhostname&lt;/span&gt;, localhost.&lt;span style=&#34;color: #f8f8f2&#34;&gt;$mydomain&lt;/span&gt;, &lt;span style=&#34;color: #f8f8f2&#34;&gt;$mydomain&lt;/span&gt;, mail.&lt;span style=&#34;color: #f8f8f2&#34;&gt;$mydomain&lt;/span&gt;, localhost
&lt;span style=&#34;color: #f8f8f2&#34;&gt;unknown_local_recipient_reject_code&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt; 550
&lt;span style=&#34;color: #f8f8f2&#34;&gt;mynetworks_style&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt; subnet
&lt;span style=&#34;color: #f8f8f2&#34;&gt;mynetworks&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt; 192.168.0.0/24, 127.0.0.0/8
&lt;span style=&#34;color: #f8f8f2&#34;&gt;relay_domains&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;$mydestination&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2&#34;&gt;alias_maps&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;hash&lt;/span&gt;:/etc/mail/aliases
&lt;span style=&#34;color: #f8f8f2&#34;&gt;alias_database&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;hash&lt;/span&gt;:/etc/mail/aliases
&lt;span style=&#34;color: #f8f8f2&#34;&gt;home_mailbox&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt; .Maildir/

&lt;span style=&#34;color: #f8f8f2&#34;&gt;header_checks&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt; regexp:/etc/postfix/header_checks
&lt;span style=&#34;color: #f8f8f2&#34;&gt;smtpd_banner&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;$myhostname&lt;/span&gt; ESMTP &lt;span style=&#34;color: #f8f8f2&#34;&gt;$mail_name&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$mail_version&lt;/span&gt;&lt;span style=&#34;color: #f92672&#34;&gt;)&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2&#34;&gt;mydestination&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;$myhostname&lt;/span&gt;, localhost.&lt;span style=&#34;color: #f8f8f2&#34;&gt;$mydomain&lt;/span&gt;, &lt;span style=&#34;color: #f8f8f2&#34;&gt;$myhostname&lt;/span&gt;.&lt;span style=&#34;color: #f8f8f2&#34;&gt;$mydomain&lt;/span&gt;, mail.&lt;span style=&#34;color: #f8f8f2&#34;&gt;$mydomain&lt;/span&gt;, localhost
&lt;span style=&#34;color: #f8f8f2&#34;&gt;debug_peer_level&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt; 2
&lt;span style=&#34;color: #f8f8f2&#34;&gt;debugger_command&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt;
         &lt;span style=&#34;color: #f8f8f2&#34;&gt;PATH&lt;/span&gt;&lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt;/bin:/usr/bin:/usr/local/bin:/usr/X11R6/bin
         xxgdb &lt;span style=&#34;color: #f8f8f2&#34;&gt;$daemon_directory&lt;/span&gt;/&lt;span style=&#34;color: #f8f8f2&#34;&gt;$process_name&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;$process_id&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;&amp;amp;&lt;/span&gt; sleep 5
&lt;span style=&#34;color: #f8f8f2&#34;&gt;sendmail_path&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt; /usr/sbin/sendmail
&lt;span style=&#34;color: #f8f8f2&#34;&gt;mailq_path&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt; /usr/bin/mailq
&lt;span style=&#34;color: #f8f8f2&#34;&gt;setgid_group&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt; postdrop
&lt;span style=&#34;color: #f8f8f2&#34;&gt;html_directory&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt; /usr/share/doc/postfix-2.2.10/html
&lt;span style=&#34;color: #f8f8f2&#34;&gt;manpage_directory&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt; /usr/share/man
&lt;span style=&#34;color: #f8f8f2&#34;&gt;sample_directory&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt; /etc/postfix
&lt;span style=&#34;color: #f8f8f2&#34;&gt;readme_directory&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt; /usr/share/doc/postfix-2.2.10/readme
&lt;span style=&#34;color: #f8f8f2&#34;&gt;smtpd_use_tls&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt; yes
&lt;span style=&#34;color: #f8f8f2&#34;&gt;smtpd_tls_loglevel&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt; 1
&lt;span style=&#34;color: #f8f8f2&#34;&gt;smtpd_tls_cert_file&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt; /etc/ssl/postfix/server.crt
&lt;span style=&#34;color: #f8f8f2&#34;&gt;smtpd_tls_key_file&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt; /etc/ssl/postfix/server.key
&lt;span style=&#34;color: #f8f8f2&#34;&gt;smtpd_tls_session_cache_database&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt; btree:/etc/postfix/smtpd_scache
&lt;span style=&#34;color: #f8f8f2&#34;&gt;smtpd_sasl_auth_enable&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt; yes
&lt;span style=&#34;color: #f8f8f2&#34;&gt;smtpd_sasl_security_options&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt; noanonymous
&lt;span style=&#34;color: #f8f8f2&#34;&gt;smtp_sasl_security_options&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt; noanonymous
&lt;span style=&#34;color: #f8f8f2&#34;&gt;allow_mail_to_commands&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;alias&lt;/span&gt;,forward,include
&lt;span style=&#34;color: #f8f8f2&#34;&gt;message_size_limit&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt; 1024000
&lt;span style=&#34;color: #f8f8f2&#34;&gt;smtpd_client_restrictions&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt;
            permit_mynetworks,
            permit_sasl_authenticated,
            permit_auth_destination,
            reject

vi /etc/postfix/master.cf

submission inet n      -       n       -       -       smtpd
        -o &lt;span style=&#34;color: #f8f8f2&#34;&gt;smtpd_etrn_restrictions&lt;/span&gt;&lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt;reject
        -o &lt;span style=&#34;color: #f8f8f2&#34;&gt;smtpd_client_restrictions&lt;/span&gt;&lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt;permit_sasl_authenticated,reject
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;h4&gt;saslの設定&lt;/h4&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;vi /etc/sasl2/smtpd.conf

pwcheck_method: saslauthd

mkdir /var/state/saslauthd
chmod &lt;span style=&#34;color: #ae81ff&#34;&gt;700&lt;/span&gt; /var/state/saslauthd
chown postfix /var/state/saslauthd
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;h4&gt;dovecotの設定&lt;/h4&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;vi /etc/dovecot.conf

&lt;span style=&#34;color: #f8f8f2&#34;&gt;protocols&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt; pop3 imap
&lt;span style=&#34;color: #f8f8f2&#34;&gt;ssl_disable&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt; no
&lt;span style=&#34;color: #f8f8f2&#34;&gt;ssl_cert_file&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt; /etc/ssl/postfix/server.crt
&lt;span style=&#34;color: #f8f8f2&#34;&gt;ssl_key_file&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt; /etc/ssl/postfix/server.key
&lt;span style=&#34;color: #f8f8f2&#34;&gt;default_mail_env&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt; maildir:%h/.Maildir

chmod &lt;span style=&#34;color: #ae81ff&#34;&gt;755&lt;/span&gt; /var/run/dovecot
chmod &lt;span style=&#34;color: #ae81ff&#34;&gt;750&lt;/span&gt; /var/run/dovecot/login
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;あとはデフォルトのまま。&lt;/p&gt;

&lt;p&gt;&lt;h4&gt;クライアントの設定&lt;/h4&gt;
まずはオレオレ認証局の証明書をクライアントに入れる必要がある（やらなくてもいいが警告が出るので…）。別にどうやってクライアントに渡してもOK。FTPとかSCPとかで適当に。メーラによって操作が違うがThunderbirdの場合は、ツール→オプション→プライバシー→セキュリティ→証明書を表示→認証局証明書→インポートと進んで、cacert.derを選択すればOK。あとはIMAPでアカウントを作って、受信は143番ポートでTLSを使うようにし、送信は587番ポートで同じくTLSを使うように設定する。送信テストするとユーザ名とパスワードが聞かれるので「パスワード無しで送信できないこと」「間違ったパスワードを入れて送信できないこと」「正しいパスワードを入れて送信できること」の3つを確認して終了。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>[memo] iptablesが使えないのでkernel再構築 &amp; sshdへのアタックをどうにかする</title>
      <link>http://nobu666.com/2006/10/28/421.html</link>
      <pubDate>Sat, 28 Oct 2006 04:12:00 +0900</pubDate>
      
      <guid>http://nobu666.com/2006/10/28/421.html</guid>
      <description>&lt;p&gt;なんつーかね、某krからのsshdへのBrute force attacksが酷すぎる。auth.logを埋め尽くすほどのアタックを食らったので対策することに。だが普通にインストールするとiptablesが動いてくれないので、カーネル再構築に挑戦する。&lt;/p&gt;

&lt;p&gt;別に今回はkernelのバージョンを上げたいわけではなく、単純にカーネルのオプションを変えたいだけなので、emerge gentoo-sourcesはやらない。以下、rootになって作業を行う。あとmenuconfigはscreenの中でやると表示が乱れて酷いことになるので、screenをデタッチするなり抜けるなりしてからやったほうがいい。&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;cd&lt;/span&gt; /usr/src/linux
make menuconfig
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Confgurationが立ち上がったら、まずLoad an Alternate Configuration Fileを選ぶ。&amp;rdquo;.config&amp;rdquo;が入力されているはずなので、そのままOKすると現在の設定が読み込まれる。そしたら&lt;/p&gt;

&lt;pre&gt;
Networking  ---&gt;
  Networking options  ---&gt; 
    Network packet filtering (replaces ipchains)  ---&gt;
      Core Netfilter Configuration  ---&gt;
         Netfilter Xtables support (required for ip_tables)
&lt;/pre&gt;

&lt;p&gt;を選択。その下に色々あるが、よくわからないならMにしといてあとでModuleとして読めるようにしておくと吉。必要なのに何もチェックしないでおくと、再度カーネル再構築が必要になって面倒なので。チェックしたら1つ戻ってIP: Netfilter Configurationの中に入る。とりあえず必須なのはIP tables support (required for filtering/masq/NAT)と、IP range match support、Packet filtering、REJECT target support、address type match support、Full NAT、MASQUERADE target supportとかそのへん。終わったらTOPまで戻って、念のため設定ファイルをなんか名前付けて保存しておいたほうがいい。&lt;/p&gt;

&lt;p&gt;あとはその辺のサイトに書いてあるとおり、お約束でOK。&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;make &lt;span style=&#34;color: #f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; make modules_install
cp arch/x86_64/boot/bzImage /boot/なんか適当な名前
vi /boot/grub/grub.conf
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;grub.confの設定では、元々書いてあるものを絶対に消さないこと。消しちゃうと万が一再構築したカーネルで起動できなかったときに面倒。&lt;/p&gt;

&lt;p&gt;[sourecode lang=&amp;ldquo;text&amp;rdquo;]
title=Gentoo Linux 2.6.17-r8
root (hd0,0)
kernel /さっきbootの下にcpしたファイル名 root=/dev/sda3 vga=ask&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;とかで問題なし。vga=askの部分はまぁお好みで。/usr/src/linux/Documentation/fb/vesafb.txtとかを参考に。基本的にはこれでrebootして、上のtitleでつけた名前を選択して起動してやればとりあえずOKなはずだ。失敗したら残しておいた方で起動して修正すべし。消してしまったお馬鹿さんはinstall cdから起動して/dev/sda1とかをmountして編集すれば戻せる。あとvgaとかvideoのオプションは、間違うと画面に何も表示されなくなるので注意。まぁリモート操作がメインならそれでもいいのかも知れないけど、何かあったときにアレなんで…心配ならaskにしておいて選択するのが間違いない。

そこまで出来たらDebian GNU/Linux 3.1(sarge)運用ノートの&lt;span style=&#34;color: #f92672&#34;&gt;&amp;lt;a&lt;/span&gt; &lt;span style=&#34;color: #a6e22e&#34;&gt;href=&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;quot;http://www.musicae.ath.cx/diary/?200506c&amp;amp;to=200506272#200506272&amp;quot;&lt;/span&gt; &lt;span style=&#34;color: #a6e22e&#34;&gt;target=&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;quot;_blank&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #f92672&#34;&gt;&amp;gt;&lt;/span&gt;SSH Brute force attacks&lt;span style=&#34;color: #f92672&#34;&gt;&amp;lt;/a&amp;gt;&lt;/span&gt;の通りに設定してから

```bash
/etc/init.d/iptables save
/etc/init.d/iptables start
rc-update add iptables default
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;以上で終了。エラーが出てiptablesが動かない場合は必要なモジュールが選択漏れでコンパイルされていないとか、Mを選択したのにmodprobeなりinsmodしてない。てか俺もこの手順にたどり着くまで5回くらい再構築してこんな時間に…もう寝る!&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>[memo] postfix &#43; dovecotでSMTP AUTH &amp; IMAPなメールサーバを立ち上げる</title>
      <link>http://nobu666.com/2006/10/25/420.html</link>
      <pubDate>Wed, 25 Oct 2006 23:59:30 +0900</pubDate>
      
      <guid>http://nobu666.com/2006/10/25/420.html</guid>
      <description>&lt;p&gt;2006/10/29追記: イマイチ不正確なので&lt;a href=&#34;http://nobu666.com/2006/10/29/000423.html&#34;&gt;[修正版][memo] postfix + dovecotでSMTP AUTH &amp;amp; IMAPなメールサーバを立ち上げる&lt;/a&gt;で書き直しました。そちらをみてください。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>[memo] サーバのCPU動作周波数を動的に変える</title>
      <link>http://nobu666.com/2006/10/24/418.html</link>
      <pubDate>Tue, 24 Oct 2006 15:50:23 +0900</pubDate>
      
      <guid>http://nobu666.com/2006/10/24/418.html</guid>
      <description>&lt;p&gt;&lt;a href=&#34;http://nobu666.com/2006/10/23/000415.html&#34;&gt;[memo] サーバのCPU動作周波数を下げる&lt;/a&gt;の続き。&lt;/p&gt;

&lt;p&gt;やってみないとわからんので、cpufreq_ondemandを試してみる。&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;modprobe cpufreq_ondemand
&lt;span style=&#34;color: #f8f8f2&#34;&gt;echo &lt;/span&gt;ondemand &amp;gt; /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor

&lt;span style=&#34;color: #f8f8f2&#34;&gt;cd&lt;/span&gt; /sys/devices/system/cpu/cpu0/cpufreq/ondemand/
ls
ignore_nice_load  sampling_down_factor  sampling_rate  sampling_rate_max  sampling_rate_min  up_threshold

cat ignore_nice_load
0

cat sampling_down_factor
1

cat sampling_rate
1040000

cat sampling_rate_max
520000000

cat sampling_rate_min
520000

cat up_threshold
80
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;詳細は&lt;a href=&#34;http://mowamowa.p.utmc.or.jp/~amedama/cgi-bin/wiki/wiki.cgi?page=Kernel+%A5%E1%A5%E2+ondemand&#34; target=&#34;_blank&#34;&gt;Kernel メモ ondemand&lt;/a&gt;参照。とりあえずignore_nice_loadは1に設定しておいた。急がないけど負荷になりそうな作業なんかはniceすること。&lt;/p&gt;

&lt;p&gt;実際にemerge &amp;ndash;syncとかして/proc/cpuinfoを見てたら、普段1GHzで動作しているのが2GHz→1.8GHzとなって1GHzに戻った。上手く動いているっぽい。試しにnice revdep-rebuildとかすると1GHzから変わらないことも確認。とりあえずこのまま運用してみる。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>[memo] TortoiseSVNからsvn&#43;sshを使う</title>
      <link>http://nobu666.com/2006/10/24/417.html</link>
      <pubDate>Tue, 24 Oct 2006 15:36:27 +0900</pubDate>
      
      <guid>http://nobu666.com/2006/10/24/417.html</guid>
      <description>&lt;p&gt;普通にsshで繋がるようになったらsvn+sshを使いたくなる。サーバー側はemerge subversionするぐらいで設定は特にない。svnadmin create /var/svn/hoge とか svn import ~/moge file:///var/svn/hogeとかしておくだけ。svnserveを立ち上げる必要はない。svn+sshで接続するときは、sshで認証した後svnserve -tを勝手にしてくれ、接続を切るとsvnserveプロセスもなくなってくれる。よってルータで3690番のポートを開けておくとかいう作業は必要ない。22番だけ開いていればいい。&lt;/p&gt;

&lt;p&gt;クライアント側は、Poderosaで作った鍵(例えばファイル名をid_rsaとする)しかない場合はPuTTY用の鍵を作る。puttygenを起動して、秘密鍵を読み込んでパスフレーズを入力すれば変換される。変換された秘密鍵をid_rsa.ppkとして保存。とりあえずPuTTYを起動して接続-データで自動ログインのユーザ名と、接続-SSH-認証で認証のためのプライベートキーファイルでさっきの.ppkファイルを設定。接続してみてパスフレーズ入力してログイン出来ればOK。&lt;/p&gt;

&lt;p&gt;次にputty.exeと同じフォルダにあるpageant.exeを起動する。タスクトレイに常駐するので右クリックして鍵の追加を選んで、.ppkを選択する。パスフレーズを入力すれば作業終わり。以降、PuTTYでもTortoiseSVNでもパスフレーズは入力しないでもいい。ただ、これはWindowsにログインしなおすと消えてしまうので、ログイン毎に鍵の追加→パスフレーズの入力を行う必要がある。ランチャーに登録するかスタートアップに入れておく。&lt;/p&gt;

&lt;p&gt;後はTortoiseSVNの設定で、ネットワークにあるSSHクライアントにTortoisePlink.exeを設定。これでTortoiseSVNからリボジトリブラウザを開いて、URL欄に svn+ssh://ユーザ名@ホスト名/var/svn/hoge と入力してエラーが出なければ終了。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>[memo] USEフラグをいい感じに管理する</title>
      <link>http://nobu666.com/2006/10/24/416.html</link>
      <pubDate>Tue, 24 Oct 2006 02:40:03 +0900</pubDate>
      
      <guid>http://nobu666.com/2006/10/24/416.html</guid>
      <description>&lt;p&gt;俺のようにしょっちゅうemergeしたい人はUSEフラグの管理が大変だ。知らないうちに勝手にgtk2フラグが有効になっててXがインストールされたりして大変ウザイ。そんなわけでGentoo使いの先輩に教えて貰ったeixとeuseを使ってみる。&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;sudo emerge eix
sudo eix-sync
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;euseはgentoolkitに入っている。eixはemerge &amp;ndash;searchと似たようなモンだがこっちのほうが速いし使いやすい。んで、本題のeuseだが、使い方自体は&amp;ndash;helpすりゃわかるんだが。フラグの説明見たり、どれが使われてるか見れたり、フラグを有効にしたり無効にしたりできる。つーか詳細はman euseで（ｗ euse使うとmake.confのUSEフラグの部分が整形されて見やすくなるのも嬉しい。まぁ説明見るだけなら /usr/portage/profiles/use.desc
 見ればいいんだが。&lt;/p&gt;

&lt;p&gt;同じくgentoolkitに含まれているequeryも激しく便利。こいつで&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;equery depends mysql
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;とかやってやればmysqlフラグに依存しているパッケージを調べることが出来るし、dependsをdepgraphに変えてやると依存関係をツリーで見れる。超便利。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>[memo] サーバのCPU動作周波数を下げる</title>
      <link>http://nobu666.com/2006/10/23/415.html</link>
      <pubDate>Mon, 23 Oct 2006 23:59:04 +0900</pubDate>
      
      <guid>http://nobu666.com/2006/10/23/415.html</guid>
      <description>&lt;p&gt;CPUに関する情報は/sys/devices/system/cpu/cpu0/cpufreq/で次のファイルをcatする。まぁファイル名のまんまだが。&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;affected_cpus : 影響する他のCPU。俺の場合はデュアルコアなので当然0と1&lt;/li&gt;
&lt;li&gt;cpuinfo_cur_freq : 現在の動作周波数&lt;/li&gt;
&lt;li&gt;cpuinfo_max_freq : 最大周波数。AMD64X2 3800+の場合は2000000&lt;/li&gt;
&lt;li&gt;cpuinfo_min_freq : 最低周波数。AMD64X2 3800+の場合は1000000&lt;/li&gt;
&lt;li&gt;scaling_available_freqyencies : 設定可能な周波数。AMD64X2 3800+の場合は2000000/1800000/1000000しかない。intelだともっと多いらしい&lt;/li&gt;
&lt;li&gt;scaling_available_governors : 設定可能な動作モード。Gentooのデフォルトではperformanceのみ&lt;/li&gt;
&lt;li&gt;scaling_cur_freq : 現在の動作周波数&lt;/li&gt;
&lt;li&gt;scaling_driver : 周波数コントロールのための仕組みの名前&lt;/li&gt;
&lt;li&gt;scaling_governor : 動作モード。scaling_available_governorsのどれか&lt;/li&gt;
&lt;li&gt;scaling_max_freq : cpuinfo_max_freqと何が違うのかわからん&lt;/li&gt;
&lt;li&gt;scaling_min_freq : cpuinfo_min_freqと何が違うのかわからん&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;普段は高周波数で動いてくれなくていいというか、その方が電気代が安くなって地球に優しいためいい感じ。そんなわけで以下の手順を踏んで周波数を下げてみた。&lt;/p&gt;

&lt;p&gt;(今の周波数を確認)&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_cur_freq
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;(どんなdriverがあるか探す)&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;find /lib/modules/2.6.17-gentoo-r7/ -name &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;*.ko&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;|&lt;/span&gt;grep cpu
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;(明らかにそれっぽい奴を見つけたので読み込む)&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;sudo modprobe cpufreq_powersave
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;(動作モードが増えたことを確認)&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_available_governors
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;(動作モードを上で確認したやつに変更)&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;su - &lt;span style=&#34;color: #f8f8f2&#34;&gt;;&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;quot;powersave&amp;quot;&lt;/span&gt; &amp;gt; /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor 
&lt;span style=&#34;color: #f8f8f2&#34;&gt;exit&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;(周波数が下がったことを確認)&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_cur_freq
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;これだと確かに周波数は下がるが下がりっぱなしだ。Gentooだと最新を追っかけたい人はコンパイルをしょっちゅうするので、そういうときにいちいち戻すのが面倒だ。そこでcpufreq_ondeamndというdriverを使うと、なんかいい感じに自動化できそうな予感がする。が、もうちょっと調べて、しっかり設定しないと下がりっぱなしとか上がりっぱなしになりそうな予感がするのでとりあえずスルー。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>[memo] Gentooインストールメモ</title>
      <link>http://nobu666.com/2006/10/22/413.html</link>
      <pubDate>Sun, 22 Oct 2006 20:04:41 +0900</pubDate>
      
      <guid>http://nobu666.com/2006/10/22/413.html</guid>
      <description>&lt;p&gt;特に書くことないほどあっさり終了。&lt;a href=&#34;http://mirror.gentoo.gr.jp/releases/amd64/current/livecd/livecd-amd64-installer-2006.1.iso&#34;&gt;LiveCD&lt;/a&gt;を焼いてそいつでブートし、デスクトップ画面が出てきたら&amp;rdquo;Gentoo Linux installer&amp;rdquo;をダブルクリックして指示に従っていくだけ。つか&lt;a href=&#34;http://www9.ocn.ne.jp/~pcvolu/pcnet/gentopage122.htm&#34; target=&#34;_blank&#34;&gt;パソコンふぉあ障害者ず Gentoo Linux 2006.0(インストール-LiveCD-)&lt;/a&gt;を参考に。変えたところはIPアドレスとかその辺のネットワーク設定周りと、ステージを3からにしたのと、CFLAGで-O3にしたぐらい。インストールが終わったら上部のメニューからrebootしてCD抜いて終わり。&lt;/p&gt;

&lt;p&gt;pingして外に繋がることを確認したら&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;emerge --sync
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;してから、必要なものをガンガン入れるんだが、その前に&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;/etc/init.d/hdparm start
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;してDMAを有効にしておく。んでいい加減sshで繋いで作業したいので&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;nano -w /etc/ssh/sshd_config
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;で適切にsshを設定。&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;PermitRootLogin no
RSAAuthentication yes
PubkeyAuthentication yes
AuthorizedKeysFile .ssh/authorized_keys
PasswordAuthentication no
PermitEmptyPasswords no
ChallengeResponseAuthentication no
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;とかそんな感じに。&lt;/p&gt;

&lt;p&gt;クライアントで鍵セットを作って、USBメモリでサーバに公開鍵を置く。マウントするのは&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;mkdir /mnt/usbmemory
mount -t vfat /dev/sdb1 /mnt/usbmemory
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;で、/mnt/usbmemoryが見えるようになる。後は公開鍵を置いてパーミッション変えればOK。&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;mkdir ~/.ssh
cat /mnt/usbmemory/id_rsa &amp;gt;&amp;gt; ~/.ssh/authorized_keys
chmod &lt;span style=&#34;color: #ae81ff&#34;&gt;700&lt;/span&gt; ~/.ssh
chmod &lt;span style=&#34;color: #ae81ff&#34;&gt;600&lt;/span&gt; ~/.ssh/authorized_keys
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;クライアントからsshで繋いでrootになって、ひたすら&lt;code&gt;emerge -av パッケージ名&lt;/code&gt;。入れたパッケージは以下の通り。&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;管理系:gentoolkit/htop/traceroute/tcpdump&lt;/li&gt;
&lt;li&gt;デーモン系:apache2/proftpd/mysql/subversion/trac/samba&lt;/li&gt;
&lt;li&gt;ユーティリティ系:sudo/screen/ftp/zsh/w3m/svk/lv/nkf&lt;/li&gt;
&lt;li&gt;言語:python/ruby/jdk/groovy&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;keywordでmaskされてるとか怒られるやつは&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;ACCEPT_KEYWORDS&lt;/span&gt;&lt;span style=&#34;color: #f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;quot;~amd64&amp;quot;&lt;/span&gt; emerge -av パッケージ名
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;で入る。色々入れたり消したりしてるうちに依存関係がおかしくなったりしたときは、revdep-rebuildする。特定のライブラリに依存するもの、とかの指定もできる。&lt;/p&gt;

&lt;p&gt;あとはapacheやらsambaやらの設定だな。&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>