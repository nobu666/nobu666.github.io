<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>2012s on Real Beat</title>
    <link>http://localhost:1313/2012.html</link>
    <description>Recent content in 2012s on Real Beat</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>ja</language>
    <lastBuildDate>Thu, 19 Jan 2012 12:49:13 +0900</lastBuildDate>
    <atom:link href="http://localhost:1313/2012.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>SSH Port FowardでMySQLを使う</title>
      <link>http://localhost:1313/2012/01/19/931.html</link>
      <pubDate>Thu, 19 Jan 2012 12:49:13 +0900</pubDate>
      
      <guid>http://localhost:1313/2012/01/19/931.html</guid>
      <description>&lt;p&gt;気づいたら年が明けていますが俺は元気です。&lt;/p&gt;

&lt;p&gt;タイトル通りなんだけど、あるMySQLサーバへつなぐためには踏み台を通らないといけなくて、いちいち&lt;/p&gt;

&lt;p&gt;[sourcecode language=&amp;ldquo;bash&amp;rdquo; padlinenumbers=&amp;ldquo;2&amp;rdquo;]
localhost$ ssh -t gateway ssh dbserver
dbserver$ mysql -uhoge -p&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;
とかやらないといけなくて、めんどい。というかこれだとローカルの開発環境で、一時的にdbserverで動作してるMySQLのデータを使いたいときとか困る。ダンプしてローカルに持ってくればいいけど、データがものすごいデカかったりしてだるい。どうにかしたい。

というわけで、Port Forwardすればいいじゃないかと思って

[sourcecode language=&amp;quot;bash&amp;quot; padlinenumbers=&amp;quot;2&amp;quot;]
$ ssh -Nf -L 13306:dbserver:3306 gateway
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;とかして、&lt;/p&gt;

&lt;p&gt;[sourcecode language=&amp;ldquo;text&amp;rdquo; padlinenumbers=&amp;ldquo;2&amp;rdquo;]
$ mysql -uhoge -p -P13306&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;
これで勝つる！！！と思ったら、これでは繋がらない。でもtelnet localhost 13306とか叩いてみると繋がるように見える。

[sourcecode language=&amp;quot;text&amp;quot; padlinenumbers=&amp;quot;2&amp;quot;]
$ telnet localhost 13306
Trying 127.0.0.1...
Connected to localhost.
Escape character is &#39;^]&#39;.
L
5.5.8-log
         $;2)s.%n!
                  ?QV;dgXbeUZBymysql_native_password
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;なにこれどういうことなの、と思って色々試したり調べたりしていたら、答えは意外なところに。&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://enginsite.com/tunnel_howto.htm&#34;&gt;What is SSH Port Forwarding and How It Works&lt;/a&gt;ってページに書いてあった。&lt;/p&gt;

&lt;blockquote&gt;When the remote SSH host is on a different machine than the MySQL server, replace 127.0.0.1 with the IP address of the MySQL server (relative to the SSH host). Never use &#34;localhost&#34; for hostname.&lt;/blockquote&gt;

&lt;p&gt;Never use “localhost” for hostname、だと……??&lt;/p&gt;

&lt;p&gt;[sourcecode language=&amp;ldquo;text&amp;rdquo; padlinenumbers=&amp;ldquo;2&amp;rdquo;]
$ mysql -uhoge -p -P13306 -h127.0.0.1
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 1058649
Server version: 5.5.8-log MySQL Community Server (GPL)&lt;/p&gt;

&lt;p&gt;Type &amp;lsquo;help;&amp;rsquo; or &amp;lsquo;\h&amp;rsquo; for help. Type &amp;lsquo;\c&amp;rsquo; to clear the current input statement.&lt;/p&gt;

&lt;p&gt;mysql&amp;gt;
```&lt;/p&gt;

&lt;p&gt;をををを……そして&lt;a href=&#34;http://d.hatena.ne.jp/yamamucho/20110319/1300511690&#34;&gt;SSH ポートフォワードで MySQL サーバにログインするときのメモ - 酔いどれコード&lt;/a&gt; に同じことが書いてあった。damn。localhost指定(-hオプションなしのデフォルト)だと、Unixドメインソケットを使って通信するので、当然ネットワーク越しには繋がらないよというオチでした。2時間くらいハマってしまったのでメモ。&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>